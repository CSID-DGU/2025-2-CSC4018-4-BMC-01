# config.yaml
version: "0.1"

app:
  project_name: "smart-pot-app"
  default_route: null         # null | "species" | "disease"  (router의 --force 기본값)
  skip_morphology: true       # router의 --skip-morph 기본값
  topk: 3

io:
  input_extensions: [".jpg", ".jpeg", ".png", ".JPG", ".JPEG", ".PNG"]
  outputs_dir: "outputs"
  overwrite: true
  save_preview: false         # todo: 추후 시각화 산출물(matplot등) 저장 여부

logging:
  level: "INFO"               # DEBUG | INFO | WARNING | ERROR
  fmt: "%(asctime)s %(levelname)s %(name)s: %(message)s"

labels:
  species_map:
    path: "src/train/labels/species.labels.json"
  disease_map:
    path: "src/train/labels/disease.labels.json"

preprocess:
  common:
    img_size: [224, 224]      # [W, H] 0은 미적용 의미
    to_rgb: true
    keep_ratio: 0.9
    normalize:
      enable: true
      mean: [0.485, 0.456, 0.406]
      std: [0.229, 0.224, 0.225]
  species:
    enable: true              # 종 분류용 별도 전처리 스위치
    extra: { anchor: "center" }
  disease:
    enable: true              # 병충해 분류용 별도 전처리 스위치
    extra: { anchor: "center" }

morphology:
  enable: true
  grayscale: false
  hsv_masking:
    color_ranges:
      # 녹색
      - lower: [25, 10, 10]   # [Hue, Saturation, Value]
        upper: [90, 255, 255]
      # 노란색/연한 녹색
      - lower: [10, 10, 10]
        upper: [40, 255, 255]
      # 빨강/갈색/어두운 색
      - lower: [0, 10, 10]
        upper: [10, 255, 255]
      # 매우 어두운 녹색
      - lower: [25, 5, 5]
        upper: [90, 150, 150]
    smooth_edges:
      enable: false
      blur_size: 5
  ops:
    open:   { enable: true, ksize: [5, 5], iter: 2 }
    close:  { enable: true, ksize: [9, 9], iter: 4 }
    erode:  { enable: false, ksize: [3, 3], iter: 1 }
    dilate: { enable: false, ksize: [3, 3], iter: 1 }
    tophat: { enable: false, ksize: [15, 15] }
    blackhat: { enable: false, ksize: [15, 15] }
  roi:
    enable: true
    method: "largest_contour"
    padding: 10
    roundness_threshold: 0.3

models:
  species:
    backend: "torch"          # dummy | torch | onnx | tflite
    ckpt_path: "src/train/checkpoints/species/tf_efficientnetv2_b0/ckpt.pt.best"
    label_path: "src/train/labels/species.labels.json"
    translate_path: "src/io/label_map_species.json"
    num_classes: 102
    device: cuda              # cpu | cuda | cuda:0
  disease:
    backend: "torch"          # dummy | torch | onnx | tflite
    ckpt_path: "src/train/checkpoints/disease/tf_efficientnet_b0_ns/ckpt.pt.best"
    label_path: "src/train/labels/disease.labels.json"
    translate_path: "src/io/label_map_disease.json"
    num_classes: 6
    device: cuda              # cpu | cuda | cuda:0

router:
  rules:
    - contains: "leaf"
      route: "disease"
    - contains: "plant"
      route: "species"

security:
  resolve_symlink: true
  max_file_size_mb: 100
  allow_network_paths: true

testing:
  samples_dir: "samples"
  examples:
    - "img_plant_0001.jpg"
    - "img_leaf_0001.jpg"